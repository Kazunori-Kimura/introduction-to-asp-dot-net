<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>introduction to asp dot net - ASP.NET勉強会</title>
  <!-- Latest compiled and minified CSS -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css">
  <!-- Optional theme -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap-theme.min.css">
  <!-- highlightjs -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/styles/default.min.css">
  <!-- font-awesome -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
  <style>
    /* Sticky footer styles
    -------------------------------------------------- */
    html {
      position: relative;
      min-height: 100%;
    }
    body {
      padding-top: 70px;
      /* Margin bottom by footer height */
      margin-bottom: 70px;
    }
    .footer {
      position: absolute;
      bottom: 0;
      width: 100%;
      /* Set the fixed height of the footer here */
      height: 60px;
      background-color: #f5f5f5;
    }
    /* Custom page CSS
    -------------------------------------------------- */
    /* Not required for template or sticky footer method. */
    .container {
      width: auto;
      max-width: 980px;
      padding: 0 15px;
    }
    .contents p, .contents li {
      font-size: large;
      line-height: 180%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 20px;
      margin-bottom: 15px;
    }
    .container .text-muted {
      margin: 20px 0;
    }
    .ad-block {
      width: auto;
      max-width: 768px;
    }
  </style>
  <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
  <![endif]-->
</head>
<body>

  <nav class="navbar navbar-inverse navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <a class="navbar-brand" href="http://kazunori-kimura.github.io/introduction-to-asp-dot-net/">introduction to asp dot net</a>
      </div>
      <p class="navbar-text navbar-right">
        <a href="https://github.com/Kazunori-Kimura/introduction-to-asp-dot-net" class="navbar-link" target="_blank">
          <i class="fa fa-github"></i>
          View on GitHub
        </a>
      </p>
    </div>
  </nav>

  <div class="container contents">
    <!-- contents -->
    <h1 id="-asp-net-web-api-knockout-js-single-page-application-2-"><code>ASP.NET Web API</code>と<code>knockout.js</code>によるSingle Page Application開発 (2)</h1>
<h2 id="-login-">おまけ: Login画面の作成</h2>
<ul>
<li>LoginViewModelの追加</li>
</ul>
<p><code>Models/LoginViewModel.cs</code></p>
<pre><code class="lang-cs"><span class="hljs-keyword">using</span> System.ComponentModel;
<span class="hljs-keyword">using</span> System.ComponentModel.DataAnnotations;

<span class="hljs-class"><span class="hljs-keyword">namespace</span> <span class="hljs-title">KnockoutTodo</span>.<span class="hljs-title">Models</span>
</span>{
    <span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LoginViewModel</span>
    </span>{
        [Required]
        [DisplayName(<span class="hljs-string">"ユーザー名"</span>)]
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">string</span> UserName { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }

        [Required]
        [DisplayName(<span class="hljs-string">"パスワード"</span>)]
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">string</span> Password { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    }
}
</code></pre>
<ul>
<li>LoginControllerの追加</li>
</ul>
<p><code>Controllers/LoginController.cs</code></p>
<pre><code class="lang-cs"><span class="hljs-keyword">using</span> KnockoutTodo.Models;
<span class="hljs-keyword">using</span> System.Web.Mvc;
<span class="hljs-keyword">using</span> System.Web.Security;

<span class="hljs-keyword">namespace</span> KnockoutTodo.Controllers
{
    [AllowAnonymous]
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> LoginController : Controller
    {
        <span class="hljs-comment">// GET: Login</span>
        <span class="hljs-function"><span class="hljs-keyword">public</span> ActionResult <span class="hljs-title">Index</span><span class="hljs-params">()</span>
        </span>{
            <span class="hljs-keyword">return</span> View();
        }

        <span class="hljs-comment">/// &lt;summary&gt;</span>
        <span class="hljs-comment">/// ログイン処理</span>
        <span class="hljs-comment">/// &lt;/summary&gt;</span>
        <span class="hljs-comment">/// &lt;param name="model"&gt;&lt;/param&gt;</span>
        <span class="hljs-comment">/// &lt;returns&gt;&lt;/returns&gt;</span>
        [HttpPost]
        [ValidateAntiForgeryToken]
        <span class="hljs-function"><span class="hljs-keyword">public</span> ActionResult <span class="hljs-title">Index</span><span class="hljs-params">([Bind(Include ="UserName,Password")</span>] LoginViewModel model)
        </span>{
            <span class="hljs-keyword">if</span> (ModelState.IsValid)
            {
                FormsAuthentication.SetAuthCookie(model.UserName, <span class="hljs-keyword">false</span>);
                <span class="hljs-comment">// メイン画面に遷移</span>
                <span class="hljs-keyword">return</span> RedirectToAction(<span class="hljs-string">"Index"</span>, <span class="hljs-string">"Home"</span>);
            }
            <span class="hljs-keyword">return</span> View(model);
        }

        <span class="hljs-comment">/// &lt;summary&gt;</span>
        <span class="hljs-comment">/// ログアウト処理</span>
        <span class="hljs-comment">/// &lt;/summary&gt;</span>
        <span class="hljs-comment">/// &lt;returns&gt;&lt;/returns&gt;</span>
        <span class="hljs-function"><span class="hljs-keyword">public</span> ActionResult <span class="hljs-title">SignOut</span><span class="hljs-params">()</span>
        </span>{
            FormsAuthentication.SignOut();
            <span class="hljs-keyword">return</span> RedirectToAction(<span class="hljs-string">"Index"</span>);
        }
    }
}
</code></pre>
<p>とりあえず、ログインボタンを押されたら何もチェックせず <code>Home/Index</code> に遷移する</p>
<p><br><br></p>
<ul>
<li>LoginViewの追加</li>
</ul>
<p><code>Views/Login/Index.cshtml</code></p>
<pre><code class="lang-html"><span class="hljs-annotation">@model</span> <span class="hljs-type">KnockoutTodo</span>.<span class="hljs-type">Models</span>.<span class="hljs-type">LoginViewModel</span>

@{
    <span class="hljs-type">ViewBag</span>.<span class="hljs-type">Title</span> = <span class="hljs-string">"Index"</span>;
    <span class="hljs-type">Layout</span> = <span class="hljs-string">"~/Views/Shared/_LayoutPage1.cshtml"</span>;
}

&lt;div <span class="hljs-class"><span class="hljs-keyword">class</span>=</span><span class="hljs-string">"container"</span>&gt;
    <span class="hljs-annotation">@using</span> (<span class="hljs-type">Html</span>.<span class="hljs-type">BeginForm</span>(<span class="hljs-string">"Index"</span>, <span class="hljs-string">"Login"</span>, <span class="hljs-type">FormMethod</span>.<span class="hljs-type">Post</span>,
                                                <span class="hljs-keyword">new</span> { <span class="hljs-annotation">@class</span> = <span class="hljs-string">"form-signin"</span> }))
    {
        <span class="hljs-annotation">@Html</span>.<span class="hljs-type">AntiForgeryToken</span>()

        &lt;h2 <span class="hljs-class"><span class="hljs-keyword">class</span>=</span><span class="hljs-string">"form-signin-heading"</span>&gt;<span class="hljs-type">Please</span> sign in&lt;/h2&gt;

        &lt;label <span class="hljs-keyword">for</span>=<span class="hljs-string">"UserName"</span> <span class="hljs-class"><span class="hljs-keyword">class</span>=</span><span class="hljs-string">"sr-only"</span>&gt;<span class="hljs-type">User</span> <span class="hljs-type">Name</span>&lt;/label&gt;
        &lt;input <span class="hljs-class"><span class="hljs-keyword">type</span>=</span><span class="hljs-string">"text"</span> id=<span class="hljs-string">"UserName"</span> name=<span class="hljs-string">"UserName"</span> <span class="hljs-class"><span class="hljs-keyword">class</span>=</span><span class="hljs-string">"form-control"</span>
               placeholder=<span class="hljs-string">"User Name"</span> required autofocus&gt;
        &lt;label <span class="hljs-keyword">for</span>=<span class="hljs-string">"Password"</span> <span class="hljs-class"><span class="hljs-keyword">class</span>=</span><span class="hljs-string">"sr-only"</span>&gt;<span class="hljs-type">Password</span>&lt;/label&gt;
        &lt;input <span class="hljs-class"><span class="hljs-keyword">type</span>=</span><span class="hljs-string">"password"</span> id=<span class="hljs-string">"Password"</span> name=<span class="hljs-string">"Password"</span> <span class="hljs-class"><span class="hljs-keyword">class</span>=</span><span class="hljs-string">"form-control"</span>
               placeholder=<span class="hljs-string">"Password"</span> required&gt;

        &lt;button <span class="hljs-class"><span class="hljs-keyword">class</span>=</span><span class="hljs-string">"btn btn-lg btn-primary btn-block"</span> <span class="hljs-class"><span class="hljs-keyword">type</span>=</span><span class="hljs-string">"submit"</span>&gt;<span class="hljs-type">Sign</span> in&lt;/button&gt;
    }
&lt;/div&gt;
</code></pre>
<ul>
<li>base.cssの修正</li>
</ul>
<p><code>base.css</code></p>
<pre><code class="lang-css"><span class="hljs-tag">body</span> <span class="hljs-rules">{
  <span class="hljs-rule"><span class="hljs-attribute">margin-top</span>:<span class="hljs-value"> <span class="hljs-number">70px</span></span></span>;
}</span>

<span class="hljs-comment">/* -- login -- */</span>
<span class="hljs-class">.form-signin</span> <span class="hljs-rules">{
  <span class="hljs-rule"><span class="hljs-attribute">max-width</span>:<span class="hljs-value"> <span class="hljs-number">330px</span></span></span>;
  <span class="hljs-rule"><span class="hljs-attribute">padding</span>:<span class="hljs-value"> <span class="hljs-number">15px</span></span></span>;
  <span class="hljs-rule"><span class="hljs-attribute">margin</span>:<span class="hljs-value"> <span class="hljs-number">0</span> auto</span></span>;
}</span>
<span class="hljs-class">.form-signin</span> <span class="hljs-class">.form-signin-heading</span>,
<span class="hljs-class">.form-signin</span> <span class="hljs-class">.checkbox</span> <span class="hljs-rules">{
  <span class="hljs-rule"><span class="hljs-attribute">margin-bottom</span>:<span class="hljs-value"> <span class="hljs-number">10px</span></span></span>;
}</span>
<span class="hljs-class">.form-signin</span> <span class="hljs-class">.checkbox</span> <span class="hljs-rules">{
  <span class="hljs-rule"><span class="hljs-attribute">font-weight</span>:<span class="hljs-value"> normal</span></span>;
}</span>
<span class="hljs-class">.form-signin</span> <span class="hljs-class">.form-control</span> <span class="hljs-rules">{
  <span class="hljs-rule"><span class="hljs-attribute">position</span>:<span class="hljs-value"> relative</span></span>;
  <span class="hljs-rule"><span class="hljs-attribute">height</span>:<span class="hljs-value"> auto</span></span>;
  <span class="hljs-rule"><span class="hljs-attribute">-webkit-box-sizing</span>:<span class="hljs-value"> border-box</span></span>;
     <span class="hljs-rule"><span class="hljs-attribute">-moz-box-sizing</span>:<span class="hljs-value"> border-box</span></span>;
          <span class="hljs-rule"><span class="hljs-attribute">box-sizing</span>:<span class="hljs-value"> border-box</span></span>;
  <span class="hljs-rule"><span class="hljs-attribute">padding</span>:<span class="hljs-value"> <span class="hljs-number">10px</span></span></span>;
  <span class="hljs-rule"><span class="hljs-attribute">font-size</span>:<span class="hljs-value"> <span class="hljs-number">16px</span></span></span>;
}</span>
<span class="hljs-class">.form-signin</span> <span class="hljs-rule"><span class="hljs-attribute">.form-control</span>:<span class="hljs-value">focus {
  z-index: <span class="hljs-number">2</span></span></span>;
}
<span class="hljs-class">.form-signin</span> <span class="hljs-tag">input</span><span class="hljs-attr_selector">[type="email"]</span> <span class="hljs-rules">{
  <span class="hljs-rule"><span class="hljs-attribute">margin-bottom</span>:<span class="hljs-value"> -<span class="hljs-number">1px</span></span></span>;
  <span class="hljs-rule"><span class="hljs-attribute">border-bottom-right-radius</span>:<span class="hljs-value"> <span class="hljs-number">0</span></span></span>;
  <span class="hljs-rule"><span class="hljs-attribute">border-bottom-left-radius</span>:<span class="hljs-value"> <span class="hljs-number">0</span></span></span>;
}</span>
<span class="hljs-class">.form-signin</span> <span class="hljs-tag">input</span><span class="hljs-attr_selector">[type="password"]</span> <span class="hljs-rules">{
  <span class="hljs-rule"><span class="hljs-attribute">margin-bottom</span>:<span class="hljs-value"> <span class="hljs-number">10px</span></span></span>;
  <span class="hljs-rule"><span class="hljs-attribute">border-top-left-radius</span>:<span class="hljs-value"> <span class="hljs-number">0</span></span></span>;
  <span class="hljs-rule"><span class="hljs-attribute">border-top-right-radius</span>:<span class="hljs-value"> <span class="hljs-number">0</span></span></span>;
}</span>
</code></pre>
<pre><code class="lang-xml"><span class="hljs-pi">&lt;?xml version="1.0"?&gt;</span>
<span class="hljs-comment">&lt;!--
  ASP.NET アプリケーションの構成方法の詳細については、
  http://go.microsoft.com/fwlink/?LinkId=169433 を参照してください
  --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">configuration</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">appSettings</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">add</span> <span class="hljs-attribute">key</span>=<span class="hljs-value">"webpages:Version"</span> <span class="hljs-attribute">value</span>=<span class="hljs-value">"3.0.0.0"</span>/&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">add</span> <span class="hljs-attribute">key</span>=<span class="hljs-value">"webpages:Enabled"</span> <span class="hljs-attribute">value</span>=<span class="hljs-value">"false"</span>/&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">add</span> <span class="hljs-attribute">key</span>=<span class="hljs-value">"PreserveLoginUrl"</span> <span class="hljs-attribute">value</span>=<span class="hljs-value">"true"</span>/&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">add</span> <span class="hljs-attribute">key</span>=<span class="hljs-value">"ClientValidationEnabled"</span> <span class="hljs-attribute">value</span>=<span class="hljs-value">"true"</span>/&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">add</span> <span class="hljs-attribute">key</span>=<span class="hljs-value">"UnobtrusiveJavaScriptEnabled"</span> <span class="hljs-attribute">value</span>=<span class="hljs-value">"true"</span>/&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">appSettings</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">system.web</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">compilation</span> <span class="hljs-attribute">debug</span>=<span class="hljs-value">"true"</span> <span class="hljs-attribute">targetFramework</span>=<span class="hljs-value">"4.5.2"</span>/&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">httpRuntime</span> <span class="hljs-attribute">targetFramework</span>=<span class="hljs-value">"4.5.2"</span>/&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">authentication</span> <span class="hljs-attribute">mode</span>=<span class="hljs-value">"Forms"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">forms</span> <span class="hljs-attribute">loginUrl</span>=<span class="hljs-value">"~/Login/Index"</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">authentication</span>&gt;</span>
</code></pre>
  </div>

  <br>
  <br>

  <div class="container">
    <div class="center-block ad-block">
      <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
      <!-- aaa-768x90 -->
      <ins class="adsbygoogle"
           style="display:inline-block;width:728px;height:90px"
           data-ad-client="ca-pub-5886049398949171"
           data-ad-slot="8568248344"></ins>
      <script>
      (adsbygoogle = window.adsbygoogle || []).push({});
      </script>
    </div>
  </div>

  <footer class="footer">
    <div class="container">
      <p class="text-muted">ASP.NET勉強会 , &copy; 2015 Kazunori Kimura</p>
    </div>
  </footer>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/js/bootstrap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/highlight.min.js"></script>
  <script>
  $(function(){
    $(".contents table").addClass("table");
  });
  </script>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-29149079-3', 'auto');
  ga('send', 'pageview');

</script>
</body>
</html>
